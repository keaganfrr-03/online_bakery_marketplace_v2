{% extends "base_sidebar.html" %}
{% block title %}Order History{% endblock %}

{% block sidebar %}
<h6 class="px-3 mt-3 mb-2 text-muted text-uppercase small">My Account</h6>
<ul class="nav flex-column">
    <li class="nav-item"><a class="nav-link" href="{% url 'profile' %}"><i class="bi bi-person-circle me-2"></i> Profile Info</a></li>
    <li class="nav-item"><a class="nav-link" href="{% url 'customer_orders' %}"><i class="bi bi-cart-check me-2"></i> Active Orders</a></li>
    <li class="nav-item"><a class="nav-link active" href="{% url 'customer_order_history' %}"><i class="bi bi-clock-history me-2"></i> Order History</a></li>
    <li class="nav-item"><a class="nav-link" href="{% url 'cart' %}"><i class="bi bi-bag me-2"></i> Cart</a></li>
</ul>

<h6 class="px-3 mt-4 mb-2 text-muted text-uppercase small">Navigation</h6>
<ul class="nav flex-column mb-2">
    <li class="nav-item"><a class="nav-link" href="{% url 'index' %}"><i class="bi bi-house me-2"></i> Home</a></li>
    <li class="nav-item"><a class="nav-link" href="{% url 'about' %}"><i class="bi bi-info-circle me-2"></i> About</a></li>
    <li class="nav-item"><a class="nav-link" href="{% url 'contact' %}"><i class="bi bi-envelope me-2"></i> Contact</a></li>
</ul>
{% endblock %}

{% block content %}
<h2 class="mb-4">My Order History</h2>

{# ✅ Completed Orders #}
<h4 class="mt-4">✅ Completed Orders</h4>
{% if completed_orders %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Order #</th>
                <th>Date</th>
                <th>Total</th>
                <th>Delivery Address</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for order in completed_orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                    <td>R{{ order.total_price }}</td>
                    <td>{{ order.delivery_address }}</td>
                    <td><span class="badge bg-success">Paid</span></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">No completed orders.</p>
{% endif %}

{# ❌ Cancelled Orders #}
<h4 class="mt-4">❌ Cancelled Orders</h4>
{% if cancelled_orders %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Order #</th>
                <th>Date</th>
                <th>Total</th>
                <th>Delivery Address</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for order in cancelled_orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                    <td>R{{ order.total_price }}</td>
                    <td>{{ order.delivery_address }}</td>
                    <td><span class="badge bg-danger">Cancelled</span></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">No cancelled orders.</p>
{% endif %}
{% endblock %}
