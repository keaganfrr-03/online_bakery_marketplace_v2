{% extends "admins/base_admin.html" %}
{% load static %}

{% block title %}Sales Report Preview{% endblock %}

{% block admin_content %}

<!-- Top Toolbar -->
<div class="d-flex justify-content-end mb-3 no-print">
    <a href="{% url 'admin_reports' %}" class="btn btn-outline-secondary btn-sm me-2">
        <i class="bi bi-arrow-left"></i> Back
    </a>
    <button onclick="window.print()" class="btn btn-outline-secondary btn-sm me-2">
        <i class="bi bi-printer"></i> Print
    </button>
    <a href="{% url 'admin_report_download' report_id %}?start_date={{ start_date }}&end_date={{ end_date }}" class="btn btn-outline-primary btn-sm">
        <i class="bi bi-download"></i> Download PDF
    </a>
</div>

<!-- Printable Area -->
<div class="printable-area p-4 border bg-white">

    <!-- Header -->
    <div class="text-center mb-4">
        <img src="{% static 'images/logo.png' %}" alt="Crumb & Co. Logo" style="height: 80px;">
        <h2 class="mt-2"><strong>Crumb & Co.</strong></h2>
        <p class="text-muted mb-0">Admin Analytics â€” Sales Report</p>
        <small>{{ start_date }} to {{ end_date }}</small>
    </div>

    <!-- Original Sales Table -->
    <h4 class="mt-4 mb-3"><i class="bi bi-cart-check me-2"></i>Orders</h4>
    <p>Showing orders from {{ start_date }} to {{ end_date }}</p>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Order #</th>
                <th>Customer</th>
                <th>Date</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.id }}</td>
                <td>{{ order.user.username }}</td>
                <td>{{ order.created_at|date:"Y-m-d" }}</td>
                <td>R{{ order.total_price }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <p><strong>Total Sales:</strong> R{{ total_sales|floatformat:2 }}</p>

    <!-- Footer -->
    <p class="mt-4 mb-0 text-muted">
        <small>Report generated on {{ now|date:"Y-m-d H:i" }} by {{ request.user.username }}</small>
    </p>

</div>

<!-- Bottom Toolbar -->
<div class="d-flex justify-content-start mt-4 no-print">
    <a href="{% url 'admin_reports' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Reports
    </a>
</div>

<style>
@media print {
    body * { visibility: hidden; }
    .printable-area, .printable-area * { visibility: visible; }
    .printable-area { position: absolute; left: 0; top: 0; width: 100%; }
    .no-print { display: none !important; }
}
</style>

{% endblock %}
