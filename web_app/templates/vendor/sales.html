{% extends "base_vendor.html" %}
{% block title %}Sales Overview{% endblock %}

{% block vendor_content %}
<h1 class="mb-4">Sales Overview</h1>

<!-- Summary Cards -->
<div class="row mb-4">
  <div class="col-md-3"><div class="card text-center bg-light"><div class="card-body"><h5>Today</h5><p class="fs-5">R{{ sales_today }}</p></div></div></div>
  <div class="col-md-3"><div class="card text-center bg-light"><div class="card-body"><h5>This Week</h5><p class="fs-5">R{{ sales_week }}</p></div></div></div>
  <div class="col-md-3"><div class="card text-center bg-light"><div class="card-body"><h5>This Month</h5><p class="fs-5">R{{ sales_month }}</p></div></div></div>
  <div class="col-md-3"><div class="card text-center bg-light"><div class="card-body"><h5>All Time</h5><p class="fs-5">R{{ total_sales }}</p></div></div></div>
</div>

<!-- Sales Chart -->
<div class="card mb-5">
  <div class="card-header"><h5 class="mb-0">Sales Trend (Last 30 Days)</h5></div>
  <div class="card-body">
    <canvas id="salesChart"></canvas>
  </div>
</div>

<!-- Sales Table -->
<table class="table table-striped table-bordered text-center align-middle">
  <thead class="table-dark">
    <tr>
      <th>Order ID</th>
      <th>Date</th>
      <th>Product</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>Subtotal</th>
    </tr>
  </thead>
  <tbody>
    {% for item in sales %}
    <tr>
      <td>#{{ item.order.id }}</td>
      <td>{{ item.order.created_at|date:"Y-m-d H:i" }}</td>
      <td>{{ item.product.name }}</td>
      <td>{{ item.quantity }}</td>
      <td>R{{ item.price }}</td>
      <td>R{{ item.subtotal }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="6" class="text-muted">No sales yet.</td></tr>
    {% endfor %}
  </tbody>
</table>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('salesChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'Sales (R)',
        data: {{ chart_data|safe }},
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        tension: 0.3,
        fill: true,
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: true, position: 'bottom' } },
      scales: { y: { beginAtZero: true } }
    }
  });
</script>
{% endblock %}
