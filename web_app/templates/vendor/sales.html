{% extends "base_vendor.html" %}
{% load static %}

{% block title %}Sales Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/vendor.css' %}">
{% endblock %}

{% block vendor_content %}

<div class="profile-header">
    <h2><i class="bi bi-graph-up-arrow me-2"></i> Sales Dashboard</h2>
    <p>Monitor your sales performance and key business metrics</p>
</div>

<!-- Period Filter Section -->
<div class="profile-card mb-4">
    <div class="period-filter-buttons">
        <span class="filter-label"><i class="bi bi-calendar-range me-2"></i>View Period:</span>
        <a href="?period=day" class="btn-period {% if period == 'day' %}active{% endif %}">
            <i class="bi bi-sun me-1"></i> Today
        </a>
        <a href="?period=week" class="btn-period {% if period == 'week' %}active{% endif %}">
            <i class="bi bi-calendar-week me-1"></i> This Week
        </a>
        <a href="?period=month" class="btn-period {% if period == 'month' %}active{% endif %}">
            <i class="bi bi-calendar-month me-1"></i> This Month
        </a>
    </div>
</div>

<!-- Summary Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="dashboard-card card-sales">
            <div class="card-icon">
                <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="card-content">
                <h6>Total Sales</h6>
                <p class="card-value">R{{ total_sales }}</p>
                <small class="card-change positive">
                    <i class="bi bi-arrow-up"></i> {{ sales_change_percent }}%
                </small>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="dashboard-card card-orders">
            <div class="card-icon">
                <i class="bi bi-basket"></i>
            </div>
            <div class="card-content">
                <h6>Total Orders</h6>
                <p class="card-value">{{ sales_month|floatformat:0 }}</p>
                <small class="card-change positive">
                    <i class="bi bi-arrow-up"></i> {{ sales_change_percent }}%
                </small>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="dashboard-card card-average">
            <div class="card-icon">
                <i class="bi bi-graph-up"></i>
            </div>
            <div class="card-content">
                <h6>Average Sale</h6>
                <p class="card-value">R{{ avg_sale }}</p>
                <small class="card-change positive">
                    <i class="bi bi-arrow-up"></i> {{ sales_change_percent }}%
                </small>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="dashboard-card card-growth">
            <div class="card-icon">
                <i class="bi bi-arrow-up-right"></i>
            </div>
            <div class="card-content">
                <h6>Growth Rate</h6>
                <p class="card-value">{{ growth_rate }}%</p>
                <small class="card-change positive">
                    <i class="bi bi-arrow-up"></i> {{ sales_change_percent }}%
                </small>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="row g-4">
    <div class="col-md-6">
        <div class="profile-card chart-card">
            <div class="chart-header">
                <h5><i class="bi bi-pie-chart me-2"></i>Sales by Category</h5>
                <span class="chart-badge">Line Chart</span>
            </div>
            <div class="chart-container">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="profile-card chart-card">
            <div class="chart-header">
                <h5><i class="bi bi-bar-chart me-2"></i>Sales per Product</h5>
                <span class="chart-badge">Bar Chart</span>
            </div>
            <div class="chart-container">
                <canvas id="productChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Chart.js default colors matching the theme
const brandColors = {
    primary: '#8b4d23',
    secondary: '#5C3317',
    success: '#10b981',
    warning: '#f59e0b',
    danger: '#ef4444',
    info: '#3b82f6'
};

// Category Chart (Line)
const ctxCategory = document.getElementById('categoryChart').getContext('2d');
new Chart(ctxCategory, {
    type: 'line',
    data: {
        labels: {{ category_chart_labels|safe }},
        datasets: {{ category_chart_data|safe }}
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: true,
                position: 'bottom',
                labels: {
                    padding: 15,
                    font: { size: 12, weight: '600' },
                    color: '#333'
                }
            },
            tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: 'rgba(139, 77, 35, 0.9)',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: '#8b4d23',
                borderWidth: 1,
                padding: 12,
                displayColors: true
            }
        },
        interaction: {
            mode: 'nearest',
            intersect: false
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: '#f5ebe0' },
                ticks: { color: '#6c757d', font: { size: 11 } }
            },
            x: {
                grid: { color: '#f5ebe0' },
                ticks: { color: '#6c757d', font: { size: 11 } }
            }
        }
    }
});

// Product Chart (Bar)
const ctxProduct = document.getElementById('productChart').getContext('2d');
new Chart(ctxProduct, {
    type: 'bar',
    data: {
        labels: {{ product_chart_labels|safe }},
        datasets: {{ product_chart_data|safe }}
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: true,
                position: 'bottom',
                labels: {
                    padding: 15,
                    font: { size: 12, weight: '600' },
                    color: '#333'
                }
            },
            tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: 'rgba(139, 77, 35, 0.9)',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: '#8b4d23',
                borderWidth: 1,
                padding: 12,
                displayColors: true
            }
        },
        interaction: {
            mode: 'nearest',
            intersect: false
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: '#f5ebe0' },
                ticks: { color: '#6c757d', font: { size: 11 } }
            },
            x: {
                grid: { color: '#f5ebe0' },
                ticks: { color: '#6c757d', font: { size: 11 } }
            }
        }
    }
});
</script>

{% endblock %}