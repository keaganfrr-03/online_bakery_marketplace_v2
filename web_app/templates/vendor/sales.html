{% extends "base_vendor.html" %}
{% block title %}Sales Dashboard{% endblock %}

{% block vendor_content %}
<h1 class="mb-4">ðŸ“Š Sales Dashboard</h1>

<!-- Period Filter -->
<div class="mb-4">
    <a href="?period=day" class="btn btn-outline-primary {% if period == 'day' %}active{% endif %}">Today</a>
    <a href="?period=week" class="btn btn-outline-primary {% if period == 'week' %}active{% endif %}">This Week</a>
    <a href="?period=month" class="btn btn-outline-primary {% if period == 'month' %}active{% endif %}">This Month</a>
</div>


<!-- Summary Cards -->
<div class="row g-3 mb-5">
  <div class="col-md-3">
    <div class="card text-center shadow-sm rounded-4 p-3 bg-light">
      <i class="bi bi-currency-dollar display-4 text-success"></i>
      <h6 class="mt-2">Total Sales</h6>
      <p class="fs-4 fw-bold">R{{ total_sales }}</p>
      <small class="text-success">â†‘ {{ sales_change_percent }}%</small>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center shadow-sm rounded-4 p-3 bg-light">
      <i class="bi bi-basket display-4 text-primary"></i>
      <h6 class="mt-2">Orders</h6>
      <p class="fs-4 fw-bold">{{ sales_month|floatformat:0 }}</p>
      <small class="text-success">â†‘ {{ sales_change_percent }}%</small>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center shadow-sm rounded-4 p-3 bg-light">
      <i class="bi bi-graph-up display-4 text-warning"></i>
      <h6 class="mt-2">Average Sale</h6>
      <p class="fs-4 fw-bold">R{{ avg_sale }}</p>
      <small class="text-success">â†‘ {{ sales_change_percent }}%</small>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center shadow-sm rounded-4 p-3 bg-light">
      <i class="bi bi-arrow-up-right display-4 text-danger"></i>
      <h6 class="mt-2">Growth Rate</h6>
      <p class="fs-4 fw-bold">{{ growth_rate }}%</p>
      <small class="text-success">â†‘ {{ sales_change_percent }}%</small>
    </div>
  </div>
</div>

<!-- Charts -->
<div class="row g-4">
  <div class="col-md-6">
    <div class="card shadow-sm rounded-4 p-3">
      <h6>Sales by Category</h6>
      <canvas id="categoryChart" style="height:300px;"></canvas>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card shadow-sm rounded-4 p-3">
      <h6>Sales per Product</h6>
      <canvas id="productChart" style="height:300px;"></canvas>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctxCategory = document.getElementById('categoryChart').getContext('2d');
new Chart(ctxCategory, {
    type: 'line',
    data: {
        labels: {{ category_chart_labels|safe }},
        datasets: {{ category_chart_data|safe }}
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: true, position: 'bottom' },
            tooltip: { mode: 'index', intersect: false }
        },
        interaction: { mode: 'nearest', intersect: false },
        scales: { y: { beginAtZero: true } }
    }
});

const ctxProduct = document.getElementById('productChart').getContext('2d');
new Chart(ctxProduct, {
    type: 'bar',
    data: {
        labels: {{ product_chart_labels|safe }},
        datasets: {{ product_chart_data|safe }}
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: true, position: 'bottom' },
            tooltip: { mode: 'index', intersect: false }
        },
        interaction: { mode: 'nearest', intersect: false },
        scales: { y: { beginAtZero: true } }
    }
});
</script>
{% endblock %}
